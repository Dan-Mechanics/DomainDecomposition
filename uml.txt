@startuml

class FSM 
{
    - states : readonly Dictionary<Type, IState>
    -currentState: IState
    
    + AddState(key: Type, value: IState)
    + TransitionTo(type: Type)
    + Update()
}

interface IState 
{
    + Setup(fsm : FSM)
    + EnterState()
    + Update()
    + ExitState()
}


class Timer
{
    + onTimerComplete: event Action
    
    + void SetTimer(value: float)
}

class HealthStateHandler 
{
    + interactionEvents : readonly Dictionary<string, Action>
    -fsm: readonly FSM
    
    + Setup()
    + Update()
    + Interact(string)
}

abstract class HealthState implements IState 
{
    + onEnter: event Action
    + onExit: event Action
    -handler: HealthStateHandler
    -fsm: FSM
    
    + void ReferenceHandler(handler: EventHandler)
    + virtual Setup(fsm : FSM)
    + virtual EnterState()
    + virtual Update()
    + virtual ExitState()
}


class HealthyState extends HealthState 
{
    + override Setup(fsm : FSM)
    + override EnterState()
    + override Update()
    + override ExitState()
}

class InjuredState extends HealthState 
{
    + override Setup(fsm : FSM)
    + override EnterState()
    + override Update()
    + override ExitState()
}

class DeepWoundState extends HealthState 
{
    - timer : Timer
    
    + override Setup(fsm : FSM)
    + override EnterState()
    + override Update()
    + override ExitState()
}

class DownedState extends HealthState 
{
    -recoveryProgress: float
    
    + override Setup(fsm : FSM)
    + override EnterState()
    + override Update()
    + override ExitState()
}

class InfectedState extends HealthState 
{
    - timer : Timer
    
    + override Setup(fsm : FSM)
    + override EnterState()
    + override Update()
    + override ExitState()
}

class EventHandler
{
    - events : readonly Dictionary<string, Action>
    
    + Raise(string)
    + StartListening(string, Action)
    + StopListening(string, Action)
}

note "We're drawing in elements of EventManager here." as EventNote

HealthStateHandler --* FSM
HealthStateHandler --* EventHandler
DeepWoundState ..> Timer
InfectedState ..> Timer
FSM ..> IState
HealthState ..> EventHandler


@enduml